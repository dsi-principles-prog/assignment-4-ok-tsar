---
title: "20-feature-engineering"
output: html_notebook
---

lets find maximum kill/injury rates by state

This will help us deterimine which states have had the most deadly/injury filled shootings in 2018.
```{r}
scale_max <- function(x, na.rm = FALSE) {max(x, na.rm = TRUE)}

max_by_state <- function(df, vars) {
  df %>% 
    group_by(state) %>% 
    mutate_at(vars, list(statemax = scale_max)) %>% 
    ungroup() %>% 
    select(state, contains("_statemax"), everything())
}

st_max_data <- s_data %>% 
  max_by_state(c("killed","wounded"))

ggplot(st_max_data, aes(state, killed_statemax)) +
  geom_point()
```

The most deadly shooting in 2018 happened in FL, followed by CA, PA, and TX. CT, MA, and UT had no deaths from mass shootings in 2018 

lets find maximum kill/injury rates by city.

This will show us in which cities the most deadly shootings took place, as well as show us the most deadly shooting in bigger cities that may have had a few mass shootings in 2018.
```{r}
max_by_city <- function(df, vars) {
  df %>% 
    group_by(city) %>% 
    mutate_at(vars, list(citymax = scale_max)) %>% 
    ungroup() %>% 
    select(city, contains("_citymax"), everything())
}

ct_max_data <- s_data %>% 
  max_by_city(c("killed","wounded"))

ct_max_data %>% 
  top_n(10, killed_citymax) %>% 
  ggplot(aes(city, killed_citymax)) +
  geom_point() +
  coord_flip()
```

The most deadly shooting in 2018 happened in Parkland, followed by Thousand Oaks, Pittsburg, and Santa Fe in terms of cities.


Now lets look at average shooting death danger by state

```{r}
scale_mean <- function(x, na.rm = FALSE) {mean(x, na.rm = TRUE)}

mean_by_state <- function(df, vars) {
  df %>% 
    group_by(state) %>% 
    mutate_at(vars, list(statemean = scale_mean)) %>% 
    ungroup() %>% 
    select(state, contains("_statemean"), everything())
}

st_mean_data <- s_data %>% 
  mean_by_state(c("killed","wounded"))

ggplot(st_mean_data, aes(state, killed_statemean)) +
  geom_point() +
  coord_flip()
```
The most dangerous states in terms of mean killed in mass shootings are DE and ND.

Now lets standardize death/injury rates by state.
This allows for comparison of shootings within each state to others within same state in meaningful way.
```{r}
standard_scale <- function(x, na.rm = FALSE) {(x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE)}

standardize_by_state <- function(df, vars) {
  df %>% 
    group_by(state) %>% 
    mutate_at(vars, list(std_by_state = standard_scale)) %>% 
    ungroup() %>% 
    select(state, contains("_std_by_state"), everything())
}

standardized_state_data <- s_data %>% 
  standardize_by_state(c("killed","wounded"))

standardized_state_data

```

